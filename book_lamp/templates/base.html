<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Book Lamp{% endblock %}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600&family=Playfair+Display:wght@700&display=swap"
        rel="stylesheet">
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='base.css') }}">
    {% block head %}{% endblock %}
</head>

<body>
    <nav>
        <a href="/" class="logo">Book Lamp</a>
        <div class="nav-links">
            <a href="/books">Books</a>
            <a href="/history">History</a>
            <a href="/stats">Stats</a>
            <a href="/about">About</a>
        </div>
    </nav>

    <div class="container">
        <div class="messages">
            {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
            {% for category, message in messages %}
            <div class="alert {{ category }}">{{ message }}</div>
            {% endfor %}
            {% endif %}
            {% endwith %}
        </div>

        {% block content %}{% endblock %}
    </div>

    <!-- Confirmation Modal -->
    <div id="confirm-modal" class="modal">
        <div class="modal-content">
            <h2 id="modal-title">Confirm Delete</h2>
            <p id="modal-message">Are you sure you want to delete this?</p>
            <div class="modal-actions">
                <button onclick="closeModal()" class="btn-cancel">Cancel</button>
                <button id="modal-confirm-btn" class="btn-save" style="background: #ef4444;">Delete</button>
            </div>
        </div>
    </div>

    <script>
        function showConfirm(title, message, onConfirm) {
            const modal = document.getElementById('confirm-modal');
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-message').textContent = message;
            const confirmBtn = document.getElementById('modal-confirm-btn');

            // Remove old listeners
            const newConfirmBtn = confirmBtn.cloneNode(true);
            confirmBtn.parentNode.replaceChild(newConfirmBtn, confirmBtn);

            newConfirmBtn.addEventListener('click', () => {
                onConfirm();
                closeModal();
            });

            modal.style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('confirm-modal').style.display = 'none';
        }

        // Close modal when clicking outside
        window.onclick = function (event) {
            const modal = document.getElementById('confirm-modal');
            if (event.target == modal) {
                closeModal();
            }
        }

        function submitPostRequest(urlStr) {
            try {
                var url = new URL(urlStr, window.location.origin);
                if ((url.protocol === 'http:' || url.protocol === 'https:') &&
                    url.origin === window.location.origin) {
                    var f = document.createElement('form');
                    f.method = 'POST';
                    f.action = url.toString();
                    document.body.appendChild(f);
                    f.submit();
                }
            } catch (e) {
                console.error('Failed to submit request:', e);
            }
        }
    </script>

    <footer>
        &copy; 2026 Kelvin Chappell. Built with Python and Google Sheets.
    </footer>
</body>

</html>