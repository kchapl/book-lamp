<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Book Lamp{% endblock %}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600&family=Playfair+Display:wght@700&display=swap"
        rel="stylesheet">
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='base.css') }}">
    {% block head %}{% endblock %}
</head>

<body>
    <nav>
        <a href="/" class="logo">Book Lamp</a>
        <div class="nav-links">
            <a href="/books">Books</a>
            <a href="/history">History</a>
            <a href="/reading-list">Reading List</a>
            <a href="/stats">Stats</a>
            <a href="/about">About</a>
            {% if not is_authorised %}
            <a href="/connect" class="btn btn-small">Authorise</a>
            {% endif %}

            <span id="connection-status" class="status-dot {{ 'connected' if is_authorised else 'disconnected' }}"
                title="{{ 'Google Sheets Connected (Click to Disconnect)' if is_authorised else 'Google Sheets Not Connected (Click to Authorise)' }}"
                data-authorised="{{ 'true' if is_authorised else 'false' }}" onclick="toggleConnection()"></span>
        </div>
    </nav>

    <!-- Background Job Progress Indicator -->
    <div id="job-indicator">
        <!-- Subtle progress bar -->
        <div id="job-progress-bar">
            <div id="job-progress-fill">
            </div>
        </div>
        <!-- Status message below progress bar -->
        <div class="job-status-bar">
            <span class="job-pulse-dot"></span>
            <span id="job-status-text">Processing...</span>
        </div>
    </div>



    <div class="container pt-1">
        <div class="messages">
            {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
            {% for category, message in messages %}
            <div class="alert {{ category }}">
                {% if category == 'success' %}
                <span>✨</span>
                {% elif category == 'error' %}
                <span>⚠️</span>
                {% elif category == 'info' %}
                <span>ℹ️</span>
                {% endif %}
                <span>{{ message }}</span>
            </div>
            {% endfor %}
            {% endif %}
            {% endwith %}
        </div>

        {% block content %}{% endblock %}
    </div>

    <!-- Confirmation Modal -->
    <div id="confirm-modal" class="modal">
        <div class="modal-content">
            <h2 id="modal-title">Confirm Delete</h2>
            <p id="modal-message">Are you sure you want to delete this?</p>
            <div class="modal-actions">
                <button id="modal-confirm-btn" class="btn">Confirm</button>
                <button onclick="closeModal()" class="btn btn-outline">Cancel</button>
            </div>
        </div>
    </div>


    <script src="{{ url_for('static', filename='base-ui.js') }}" type="module" defer></script>
    <script src="{{ url_for('static', filename='button-feedback.js') }}" type="module" defer></script>
    <script src="{{ url_for('static', filename='job-indicator.js') }}" type="module" defer></script>

    <footer>
        &copy; {{ current_year }} Kelvin Chappell. Built with Python and Google Sheets.
    </footer>
</body>

</html>